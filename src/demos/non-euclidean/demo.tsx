import React, { useEffect, useRef } from 'react';
import World from './src/world';
import { NextPage } from 'next';
import styles from './demo.module.css';

const Demo: NextPage = () => {
  const canvasRef = useRef<HTMLCanvasElement | null>(null);
  const world = useRef<World | null>(null);

  useEffect(() => {
    const canvas = canvasRef.current;
    if (!canvas) return;

    canvas.width = window.innerWidth;
    canvas.height = window.innerHeight;
    world.current = new World(canvas);

    world.current.addPlane(
      [0, 0, 0],
      [0, 1, 0],
      [0, 0, 1],
      [40, 40],
      [0.4, 0.7, 0.4],
      [0.4, 0.9, 0.4],
      [80, 80],
      2
    );

    world.current.addPlane(
      [-4.5, 2, 0],
      [1, 0, 0],
      [0, 1, 0],
      [20, 4],
      [0.9, 0.9, 0.9],
      [0.6, 0.6, 0.6],
      [40, 8]
    );
    world.current.addPlane(
      [-5, 1.75, 0],
      [-1, 0, 0],
      [0, 1, 0],
      [20, 3.5],
      [0.9, 0.9, 0.9],
      [0.6, 0.6, 0.6],
      [40, 7]
    );
    world.current.addPlane(
      [-7.5, 1.75, 0],
      [1, 0, 0],
      [0, 1, 0],
      [20, 3.5],
      [0.9, 0.9, 0.9],
      [0.6, 0.6, 0.6],
      [40, 7]
    );
    world.current.addPlane(
      [-8, 2, 0],
      [-1, 0, 0],
      [0, 1, 0],
      [20, 4],
      [0.9, 0.9, 0.9],
      [0.6, 0.6, 0.6],
      [40, 8]
    );

    world.current.addPlane(
      [-4.75, 2, 10],
      [0, 0, 1],
      [0, 1, 0],
      [0.5, 4],
      [0.9, 0.9, 0.9],
      [0.6, 0.6, 0.6],
      [1, 8]
    );
    world.current.addPlane(
      [-7.75, 2, 10],
      [0, 0, 1],
      [0, 1, 0],
      [0.5, 4],
      [0.9, 0.9, 0.9],
      [0.6, 0.6, 0.6],
      [1, 8]
    );
    world.current.addPlane(
      [-6.25, 3.75, 10],
      [0, 0, 1],
      [0, 1, 0],
      [2.5, 0.5],
      [0.9, 0.9, 0.9],
      [0.6, 0.6, 0.6],
      [5, 1]
    );
    world.current.addPlane(
      [-4.75, 2, -10],
      [0, 0, 1],
      [0, 1, 0],
      [0.5, 4],
      [0.9, 0.9, 0.9],
      [0.6, 0.6, 0.6],
      [1, 8]
    );
    world.current.addPlane(
      [-7.75, 2, -10],
      [0, 0, 1],
      [0, 1, 0],
      [0.5, 4],
      [0.9, 0.9, 0.9],
      [0.6, 0.6, 0.6],
      [1, 8]
    );
    world.current.addPlane(
      [-6.25, 3.75, -10],
      [0, 0, 1],
      [0, 1, 0],
      [2.5, 0.5],
      [0.9, 0.9, 0.9],
      [0.6, 0.6, 0.6],
      [5, 1]
    );

    world.current.addPlane(
      [-6.25, 4, 0],
      [0, 1, 0],
      [0, 0, -1],
      [3.5, 20],
      [0.9, 0.9, 0.9],
      [0.6, 0.6, 0.6],
      [7, 40]
    );
    world.current.addPlane(
      [-6.25, 3.5, 0],
      [0, -1, 0],
      [0, 0, -1],
      [2.5, 20],
      [0.9, 0.9, 0.9],
      [0.6, 0.6, 0.6],
      [5, 40]
    );

    world.current.addPortalPair(
      [-6.25, 1.75, 9],
      [0, 0, 1],
      [0, 1, 0],
      [2.49, 3.49, 0.5],
      [-6.25, 1.75, -9],
      [0, 0, -1],
      [0, 1, 0],
      [2.49, 3.49, 0.5]
    );

    world.current.addPlane(
      [4.5, 2, 4.5],
      [-1, 0, 0],
      [0, 1, 0],
      [2, 4],
      [0.9, 0.9, 0.9],
      [0.6, 0.6, 0.6],
      [4, 8]
    );
    world.current.addPlane(
      [5, 1.75, 4.5],
      [1, 0, 0],
      [0, 1, 0],
      [2, 3.5],
      [0.9, 0.9, 0.9],
      [0.6, 0.6, 0.6],
      [4, 7]
    );
    world.current.addPlane(
      [7.5, 1.75, 4.5],
      [-1, 0, 0],
      [0, 1, 0],
      [2, 3.5],
      [0.9, 0.9, 0.9],
      [0.6, 0.6, 0.6],
      [4, 7]
    );
    world.current.addPlane(
      [8, 2, 4.5],
      [1, 0, 0],
      [0, 1, 0],
      [2, 4],
      [0.9, 0.9, 0.9],
      [0.6, 0.6, 0.6],
      [4, 8]
    );

    world.current.addPlane(
      [4.75, 2, 5.5],
      [0, 0, 1],
      [0, 1, 0],
      [0.5, 4],
      [0.9, 0.9, 0.9],
      [0.6, 0.6, 0.6],
      [1, 8]
    );
    world.current.addPlane(
      [7.75, 2, 5.5],
      [0, 0, 1],
      [0, 1, 0],
      [0.5, 4],
      [0.9, 0.9, 0.9],
      [0.6, 0.6, 0.6],
      [1, 8]
    );
    world.current.addPlane(
      [6.25, 3.75, 5.5],
      [0, 0, 1],
      [0, 1, 0],
      [2.5, 0.5],
      [0.9, 0.9, 0.9],
      [0.6, 0.6, 0.6],
      [5, 1]
    );
    world.current.addPlane(
      [4.75, 2, 3.5],
      [0, 0, 1],
      [0, 1, 0],
      [0.5, 4],
      [0.9, 0.9, 0.9],
      [0.6, 0.6, 0.6],
      [1, 8]
    );
    world.current.addPlane(
      [7.75, 2, 3.5],
      [0, 0, 1],
      [0, 1, 0],
      [0.5, 4],
      [0.9, 0.9, 0.9],
      [0.6, 0.6, 0.6],
      [1, 8]
    );
    world.current.addPlane(
      [6.25, 3.75, 3.5],
      [0, 0, 1],
      [0, 1, 0],
      [2.5, 0.5],
      [0.9, 0.9, 0.9],
      [0.6, 0.6, 0.6],
      [5, 1]
    );

    world.current.addPlane(
      [6.25, 4, 4.5],
      [0, 1, 0],
      [0, 0, -1],
      [3.5, 2],
      [0.9, 0.9, 0.9],
      [0.6, 0.6, 0.6],
      [7, 4]
    );
    world.current.addPlane(
      [6.25, 3.5, 4.5],
      [0, -1, 0],
      [0, 0, -1],
      [2.5, 2],
      [0.9, 0.9, 0.9],
      [0.6, 0.6, 0.6],
      [5, 4]
    );

    world.current.addPortalPair(
      [6.25, 1.75, 5.5],
      [0, 0, 1],
      [0, 1, 0],
      [2.49, 3.49, 0.5],
      [-6.25, 1.75, 7],
      [0, 0, -1],
      [0, 1, 0],
      [2.49, 3.49, 0.5]
    );
    world.current.addPortalPair(
      [6.25, 1.75, 3.5],
      [0, 0, -1],
      [0, 1, 0],
      [2.49, 3.49, 0.5],
      [-6.25, 1.75, -7],
      [0, 0, 1],
      [0, 1, 0],
      [2.49, 3.49, 0.5]
    );

    world.current.loop(60);
  }, []);

  return <canvas ref={canvasRef} className={styles.canvas} />;
};

export default Demo;
